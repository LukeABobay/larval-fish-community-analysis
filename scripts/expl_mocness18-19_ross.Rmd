---
title: "mocness18-19explore"
output: word_document
date: "2025-07-30"
knit: (function(input, encoding) {

  rmarkdown::render(

    input,

    output_dir = here::here("output"),

    output_file = paste0(xfun::sans_ext(input), '_', Sys.Date(), '.html')

    )

  })
  ---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r}
library(here)
library(tidyverse)
library(ggplot2)
```

```{r}
source(here("scripts/01_data_wrangling.R"))
```

```{r Add columns with combined location/station and min/max depth}
mocness_18_19_merge_station <- unite(mocness_2018_2019, col = "location_station", location, station, sep="_", remove = TRUE)

mocness_18_19_depth_range <- unite(mocness_18_19_merge_station, col = "depth_range", minimum_depth_m, maximum_depth_m, sep="-", remove = TRUE)
```

```{r Reduce number of larval fish taxa}
taxa_w_gt_15 <- mocness_18_19_depth_range %>%
  group_by(taxon) %>%
  summarize(n = sum(individuals_in_tow)) %>%
  ungroup() %>%
  filter(n >= 15)

mocness_18_19_major_taxa <- mocness_18_19_depth_range %>%
  filter(taxon %in% taxa_w_gt_15$taxon & taxon != "Unknown")
```

```{r Plot taxon counts by station and depth}
ggplot(mocness_18_19_depth_range, aes(x = taxon, y = individuals_in_tow)) +
  geom_bar(stat = "identity") +
  facet_grid(depth_range ~ location_station) +
  labs(title = "Taxon Counts by Station and Depth Range",
       x = "Taxon Group", y = "Count") +
  theme_light() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
# ggsave("plot_mocness_18_19_counts_station_depth.tif", plot = last_plot(), device = "tiff", path=here("output"), width = 36, height = 6, units = "in", dpi = 300)

ggplot(mocness_18_19_depth_range, aes(x = taxon, y = log(individuals_in_tow))) +
  geom_bar(stat = "identity") +
  facet_grid(depth_range ~ location_station) +
  labs(title = "Taxon Counts by Station and Depth Range",
       x = "Taxon Group", y = "log(Count)") +
  theme_light() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
# ggsave("plot_mocness_18_19_log_counts_station_depth.tif", plot = last_plot(), device = "tiff", path=here("output"), width = 36, height = 6, units = "in", dpi = 300)
```

```{r Stacked barplot of major taxa}
ggplot(mocness_18_19_major_taxa, aes(x = depth_range, y = individuals_in_tow, fill = taxon)) +
  geom_bar(stat = "identity", position = "stack") +
  facet_grid(~ location_station) +
  labs(title = "Taxon Counts by Station and Depth Range",
       x = "Taxon Group", y = "Count") +
  theme_light() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

ggplot(mocness_18_19_major_taxa, aes(x = depth_range, y = log(individuals_in_tow), fill = taxon)) +
  geom_bar(stat = "identity", position = "stack") +
  facet_grid(~ location_station) +
  labs(title = "Taxon Counts by Station and Depth Range",
       x = "Taxon Group", y = "log(Count)") +
  theme_light() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

